#!/usr/bin/env python3
# -*- coding: utf-8 -*-

from lib.core.common import identifyPasswordType
from lib.core.data import conf
from lib.core.data import logger

def start():
    """
    Identity the password type and invoke corresponding module to find out
    the origin text on some websites, if found nothing, then cracks
    the password offline.
    """
    for password in conf.password:
        # ensure password type
        password_class, password_type = identifyPasswordType(password, conf.type)
        if password_type is None:
            continue

        obj = password_class(password)

        logger.info('invoke request method of {!s} to crack online'.format(password_type))
        origin = obj.request()
        if origin:
            logger.info('the origin text of {!s} is {!s}'.format(password, origin))
        else:
            logger.warn('online crack of {!s} is unsuccessful'.format(password))
            choice = input('do you want to use {!s} offline tool to crack {!s} (Y/n)?'.format(password_type, password))
            if choice != 'n':
                logger.info('invoke crack method of {!s} to crack {!s} offline'.format(password_type, password))
                origin = obj.crack()
                if origin:
                    logger.info('the origin text of {!s} is {!s}'.format(password, origin))
                else:
                    logger.warn('offline crack of {!s} is unsuccessful'.format(password))
